<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running with MPI · Tarang.jl</title><meta name="title" content="Running with MPI · Tarang.jl"/><meta property="og:title" content="Running with MPI · Tarang.jl"/><meta property="twitter:title" content="Running with MPI · Tarang.jl"/><meta name="description" content="Documentation for Tarang.jl."/><meta property="og:description" content="Documentation for Tarang.jl."/><meta property="twitter:description" content="Documentation for Tarang.jl."/><meta property="og:url" content="https://subhk.github.io/Tarang.jl/getting_started/running_with_mpi/"/><meta property="twitter:url" content="https://subhk.github.io/Tarang.jl/getting_started/running_with_mpi/"/><link rel="canonical" href="https://subhk.github.io/Tarang.jl/getting_started/running_with_mpi/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Tarang.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Tarang.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Installing Tarang</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../first_steps/">First Steps with Tarang.jl</a></li><li class="is-active"><a class="tocitem" href>Running with MPI</a><ul class="internal"><li><a class="tocitem" href="#Basic-MPI-Execution"><span>Basic MPI Execution</span></a></li><li><a class="tocitem" href="#Process-Mesh-Strategies"><span>Process Mesh Strategies</span></a></li><li><a class="tocitem" href="#Environment-Variables"><span>Environment Variables</span></a></li><li><a class="tocitem" href="#HPC-Cluster-Execution"><span>HPC Cluster Execution</span></a></li><li><a class="tocitem" href="#Load-Balancing"><span>Load Balancing</span></a></li><li><a class="tocitem" href="#Communication-Patterns"><span>Communication Patterns</span></a></li><li><a class="tocitem" href="#Performance-Monitoring"><span>Performance Monitoring</span></a></li><li><a class="tocitem" href="#Debugging-MPI-Applications"><span>Debugging MPI Applications</span></a></li><li><a class="tocitem" href="#Common-Issues-and-Solutions"><span>Common Issues and Solutions</span></a></li><li><a class="tocitem" href="#Performance-Tips"><span>Performance Tips</span></a></li><li><a class="tocitem" href="#Benchmarking"><span>Benchmarking</span></a></li><li><a class="tocitem" href="#Next-Steps"><span>Next Steps</span></a></li></ul></li><li><a class="tocitem" href="../../pages/configuration/">Configuration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials &amp; Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Tutorial Notebooks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/overview/">Tutorials Overview</a></li><li><a class="tocitem" href="../../tutorials/ivp_2d_rbc/">Tutorial: 2D Rayleigh-Bénard Convection</a></li><li><a class="tocitem" href="../../tutorials/ivp_3d_turbulence/">Tutorial: 3D Turbulence Simulation</a></li><li><a class="tocitem" href="../../tutorials/boundary_conditions/">Tutorial: Boundary Conditions</a></li><li><a class="tocitem" href="../../tutorials/analysis_and_output/">Tutorial: Analysis and Output</a></li><li><a class="tocitem" href="../../tutorials/eigenvalue_problems/">Tutorial: Eigenvalue Problems</a></li><li><a class="tocitem" href="../../tutorials/surface_dynamics/">Surface and Boundary Dynamics</a></li><li><a class="tocitem" href="../../tutorials/rotating_shallow_water/">Rotating Shallow Water with Lagrangian Averaging</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Example Scripts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/gallery/">Example Gallery</a></li><li><a class="tocitem" href="../../examples/fluid_dynamics/">Fluid Dynamics Examples</a></li><li><a class="tocitem" href="../../examples/heat_transfer/">Heat Transfer Examples</a></li><li><a class="tocitem" href="../../examples/eigenvalue_analysis/">Eigenvalue Analysis Examples</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Jupyter Notebooks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../notebooks/rayleigh_benard/">Notebook: Rayleigh-Bénard Convection</a></li><li><a class="tocitem" href="../../notebooks/channel_flow/">Notebook: Channel Flow</a></li><li><a class="tocitem" href="../../notebooks/taylor_green/">Notebook: Taylor-Green Vortex</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">User Guide</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Core Concepts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/coordinates/">Coordinates</a></li><li><a class="tocitem" href="../../pages/bases/">Spectral Bases</a></li><li><a class="tocitem" href="../../pages/domains/">Domains</a></li><li><a class="tocitem" href="../../pages/fields/">Fields</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Problem Setup</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/operators/">Operators</a></li><li><a class="tocitem" href="../../pages/problems/">Problems</a></li><li><a class="tocitem" href="../../pages/solvers/">Solvers</a></li><li><a class="tocitem" href="../../pages/timesteppers/">Time Steppers</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Physics &amp; Modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/stochastic_forcing/">Stochastic Forcing</a></li><li><a class="tocitem" href="../../pages/temporal_filters/">Temporal Filters for Lagrangian Averaging</a></li><li><a class="tocitem" href="../../pages/les_models/">Large Eddy Simulation (LES) Models</a></li><li><a class="tocitem" href="../../pages/gql_approximation/">Generalized Quasi-Linear (GQL) Approximation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Performance &amp; Parallelism</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/gpu_computing/">GPU Computing</a></li><li><a class="tocitem" href="../../pages/parallelism/">Parallelism</a></li><li><a class="tocitem" href="../../pages/optimization/">Performance Optimization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Analysis &amp; Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/analysis/">Analysis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Advanced Topics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/tau_method/">The Tau Method for Boundary Conditions</a></li><li><a class="tocitem" href="../../pages/custom_operators/">Custom Operators</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Core</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/coordinates/">Coordinates API</a></li><li><a class="tocitem" href="../../api/bases/">Bases API</a></li><li><a class="tocitem" href="../../api/domains/">Domains API</a></li><li><a class="tocitem" href="../../api/fields/">Fields API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Operators &amp; Problems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/operators/">Operators API</a></li><li><a class="tocitem" href="../../api/problems/">Problems API</a></li><li><a class="tocitem" href="../../api/solvers/">Solvers API</a></li><li><a class="tocitem" href="../../api/timesteppers/">Timesteppers API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">GPU &amp; Performance</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/gpu/">GPU API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Extras</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/stochastic_forcing/">Stochastic Forcing API</a></li><li><a class="tocitem" href="../../api/les_models/">LES Models API</a></li><li><a class="tocitem" href="../../api/analysis/">Analysis API</a></li><li><a class="tocitem" href="../../api/io/">I/O API</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Development</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/contributing/">Contributing</a></li><li><a class="tocitem" href="../../pages/architecture/">Architecture</a></li><li><a class="tocitem" href="../../pages/testing/">Testing</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Installing Tarang</a></li><li class="is-active"><a href>Running with MPI</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running with MPI</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/subhk/Tarang.jl/blob/main/docs/src/getting_started/running_with_mpi.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-with-MPI"><a class="docs-heading-anchor" href="#Running-with-MPI">Running with MPI</a><a id="Running-with-MPI-1"></a><a class="docs-heading-anchor-permalink" href="#Running-with-MPI" title="Permalink"></a></h1><p>Tarang.jl is designed for efficient parallel computing using MPI (Message Passing Interface). This guide covers everything you need to know about running Tarang.jl simulations in parallel.</p><h2 id="Basic-MPI-Execution"><a class="docs-heading-anchor" href="#Basic-MPI-Execution">Basic MPI Execution</a><a id="Basic-MPI-Execution-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-MPI-Execution" title="Permalink"></a></h2><h3 id="Running-a-Script"><a class="docs-heading-anchor" href="#Running-a-Script">Running a Script</a><a id="Running-a-Script-1"></a><a class="docs-heading-anchor-permalink" href="#Running-a-Script" title="Permalink"></a></h3><p>Execute a Tarang.jl script with MPI using <code>mpiexec</code>:</p><pre><code class="language-bash hljs">mpiexec -n 4 julia your_script.jl</code></pre><p>The <code>-n 4</code> flag specifies 4 MPI processes. This must match your process mesh configuration in the script.</p><h3 id="Process-Mesh-Configuration"><a class="docs-heading-anchor" href="#Process-Mesh-Configuration">Process Mesh Configuration</a><a id="Process-Mesh-Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Process-Mesh-Configuration" title="Permalink"></a></h3><p>The process mesh determines how MPI processes are arranged:</p><pre><code class="language-julia hljs"># 2D process mesh (4 processes: 2×2)
dist = Distributor(coords, mesh=(2, 2))

# 1D process mesh (4 processes: 4×1)
dist = Distributor(coords, mesh=(4, 1))

# 3D process mesh (8 processes: 2×2×2)
dist = Distributor(coords, mesh=(2, 2, 2))</code></pre><div class="admonition is-success" id="Matching-Process-Count-796b4e6b27b94151"><header class="admonition-header">Matching Process Count<a class="admonition-anchor" href="#Matching-Process-Count-796b4e6b27b94151" title="Permalink"></a></header><div class="admonition-body"><p>Ensure <code>product(mesh) == number of MPI processes</code>:</p><pre><code class="language-julia hljs">mesh=(2, 2)  # requires: mpiexec -n 4
mesh=(4, 2)  # requires: mpiexec -n 8
mesh=(4, 4)  # requires: mpiexec -n 16</code></pre></div></div><h2 id="Process-Mesh-Strategies"><a class="docs-heading-anchor" href="#Process-Mesh-Strategies">Process Mesh Strategies</a><a id="Process-Mesh-Strategies-1"></a><a class="docs-heading-anchor-permalink" href="#Process-Mesh-Strategies" title="Permalink"></a></h2><h3 id="2D-Problems"><a class="docs-heading-anchor" href="#2D-Problems">2D Problems</a><a id="2D-Problems-1"></a><a class="docs-heading-anchor-permalink" href="#2D-Problems" title="Permalink"></a></h3><p>For 2D problems, you can parallelize in both directions:</p><pre><code class="language-julia hljs"># Balanced 2D decomposition (recommended)
mesh=(4, 4)  # 16 processes, good for most 2D problems

# Horizontal decomposition (for thin domains)
mesh=(8, 2)  # 16 processes, more processes in x-direction

# Vertical decomposition (for tall domains)
mesh=(2, 8)  # 16 processes, more processes in z-direction</code></pre><p><strong>Rule of thumb</strong>: Match the mesh aspect ratio to your domain aspect ratio.</p><h3 id="3D-Problems"><a class="docs-heading-anchor" href="#3D-Problems">3D Problems</a><a id="3D-Problems-1"></a><a class="docs-heading-anchor-permalink" href="#3D-Problems" title="Permalink"></a></h3><p>For 3D problems, Tarang.jl uses pencil decomposition:</p><pre><code class="language-julia hljs"># Cubic mesh (for isotropic domains)
mesh=(4, 4, 4)  # 64 processes

# Anisotropic mesh (for stratified flows)
mesh=(8, 8, 2)  # 128 processes, fewer in vertical direction</code></pre><p><strong>Pencil decomposition</strong> means data is distributed in two dimensions while remaining contiguous in the third. This enables efficient parallel FFTs.</p><h2 id="Environment-Variables"><a class="docs-heading-anchor" href="#Environment-Variables">Environment Variables</a><a id="Environment-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Environment-Variables" title="Permalink"></a></h2><h3 id="Thread-Control"><a class="docs-heading-anchor" href="#Thread-Control">Thread Control</a><a id="Thread-Control-1"></a><a class="docs-heading-anchor-permalink" href="#Thread-Control" title="Permalink"></a></h3><p>Set OpenMP thread count to avoid oversubscription:</p><pre><code class="language-bash hljs">export OMP_NUM_THREADS=1
mpiexec -n 8 julia script.jl</code></pre><div class="admonition is-warning" id="Performance-Impact-a593f1f40b73f09c"><header class="admonition-header">Performance Impact<a class="admonition-anchor" href="#Performance-Impact-a593f1f40b73f09c" title="Permalink"></a></header><div class="admonition-body"><p>Not setting <code>OMP_NUM_THREADS=1</code> can cause significant performance degradation. Tarang.jl will warn you if this is not set correctly.</p></div></div><h3 id="Julia-Threads"><a class="docs-heading-anchor" href="#Julia-Threads">Julia Threads</a><a id="Julia-Threads-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-Threads" title="Permalink"></a></h3><p>Julia&#39;s multithreading can work alongside MPI:</p><pre><code class="language-bash hljs">export JULIA_NUM_THREADS=4
export OMP_NUM_THREADS=1
mpiexec -n 4 julia script.jl</code></pre><p>This gives you 4 MPI processes × 4 Julia threads = 16 parallel tasks.</p><h3 id="Other-Useful-Variables"><a class="docs-heading-anchor" href="#Other-Useful-Variables">Other Useful Variables</a><a id="Other-Useful-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Other-Useful-Variables" title="Permalink"></a></h3><pre><code class="language-bash hljs"># FFTW optimization
export FFTW_PLANNING_RIGOR=FFTW_MEASURE

# Tarang logging
export TARANG_LOG_LEVEL=DEBUG

# MPI debugging
export OMPI_MCA_mpi_show_mca_params=1</code></pre><h2 id="HPC-Cluster-Execution"><a class="docs-heading-anchor" href="#HPC-Cluster-Execution">HPC Cluster Execution</a><a id="HPC-Cluster-Execution-1"></a><a class="docs-heading-anchor-permalink" href="#HPC-Cluster-Execution" title="Permalink"></a></h2><h3 id="SLURM"><a class="docs-heading-anchor" href="#SLURM">SLURM</a><a id="SLURM-1"></a><a class="docs-heading-anchor-permalink" href="#SLURM" title="Permalink"></a></h3><p>Example SLURM submission script:</p><pre><code class="language-bash hljs">#!/bin/bash
#SBATCH --job-name=tarang_sim
#SBATCH --nodes=4
#SBATCH --ntasks-per-node=32
#SBATCH --time=24:00:00
#SBATCH --partition=compute

# Load modules
module load julia/1.9
module load openmpi/4.1

# Set environment
export OMP_NUM_THREADS=1
export JULIA_NUM_THREADS=1

# Calculate total tasks
NTASKS=$((SLURM_NNODES * SLURM_NTASKS_PER_NODE))

# Run simulation
srun -n $NTASKS julia --project=. simulation.jl</code></pre><p>Submit with:</p><pre><code class="language-bash hljs">sbatch submit_tarang.sh</code></pre><h3 id="PBS/Torque"><a class="docs-heading-anchor" href="#PBS/Torque">PBS/Torque</a><a id="PBS/Torque-1"></a><a class="docs-heading-anchor-permalink" href="#PBS/Torque" title="Permalink"></a></h3><p>Example PBS script:</p><pre><code class="language-bash hljs">#!/bin/bash
#PBS -N tarang_sim
#PBS -l nodes=4:ppn=32
#PBS -l walltime=24:00:00
#PBS -q batch

cd $PBS_O_WORKDIR

module load julia/1.9
module load openmpi/4.1

export OMP_NUM_THREADS=1

mpiexec julia --project=. simulation.jl</code></pre><p>Submit with:</p><pre><code class="language-bash hljs">qsub submit_tarang.pbs</code></pre><h2 id="Load-Balancing"><a class="docs-heading-anchor" href="#Load-Balancing">Load Balancing</a><a id="Load-Balancing-1"></a><a class="docs-heading-anchor-permalink" href="#Load-Balancing" title="Permalink"></a></h2><h3 id="Automatic-Load-Balancing"><a class="docs-heading-anchor" href="#Automatic-Load-Balancing">Automatic Load Balancing</a><a id="Automatic-Load-Balancing-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Load-Balancing" title="Permalink"></a></h3><p>Tarang.jl automatically distributes work across MPI processes using PencilArrays. For balanced performance:</p><ol><li><strong>Use power-of-2 process counts</strong> when possible (4, 8, 16, 32, ...)</li><li><strong>Match mesh to domain</strong>: Aspect ratio of mesh should match domain</li><li><strong>Consider memory</strong>: Each process needs enough RAM for its subdomain</li></ol><h3 id="Checking-Load-Distribution"><a class="docs-heading-anchor" href="#Checking-Load-Distribution">Checking Load Distribution</a><a id="Checking-Load-Distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Checking-Load-Distribution" title="Permalink"></a></h3><p>Add diagnostics to your script:</p><pre><code class="language-julia hljs">rank = MPI.Comm_rank(MPI.COMM_WORLD)
size = MPI.Comm_size(MPI.COMM_WORLD)

local_size = size(T.data)  # Size of local data on this rank

println(&quot;Rank $rank: Local array size = $local_size&quot;)</code></pre><h2 id="Communication-Patterns"><a class="docs-heading-anchor" href="#Communication-Patterns">Communication Patterns</a><a id="Communication-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Communication-Patterns" title="Permalink"></a></h2><h3 id="PencilArrays-Transposes"><a class="docs-heading-anchor" href="#PencilArrays-Transposes">PencilArrays Transposes</a><a id="PencilArrays-Transposes-1"></a><a class="docs-heading-anchor-permalink" href="#PencilArrays-Transposes" title="Permalink"></a></h3><p>Tarang.jl uses PencilArrays for efficient data distribution. Key operations:</p><ul><li><strong>FFTs</strong>: May require transposes between different pencil orientations</li><li><strong>Derivatives</strong>: Computed in spectral space (minimal communication)</li><li><strong>Nonlinear terms</strong>: Evaluated in grid space (may require transforms)</li></ul><h3 id="Minimizing-Communication"><a class="docs-heading-anchor" href="#Minimizing-Communication">Minimizing Communication</a><a id="Minimizing-Communication-1"></a><a class="docs-heading-anchor-permalink" href="#Minimizing-Communication" title="Permalink"></a></h3><p>To reduce communication overhead:</p><ol><li><strong>Group operations</strong>: Batch multiple operations before synchronizing</li><li><strong>Use larger process counts</strong>: More processes = smaller messages</li><li><strong>Optimize process mesh</strong>: Align with dominant communication direction</li></ol><h2 id="Performance-Monitoring"><a class="docs-heading-anchor" href="#Performance-Monitoring">Performance Monitoring</a><a id="Performance-Monitoring-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Monitoring" title="Permalink"></a></h2><h3 id="MPI-Profiling"><a class="docs-heading-anchor" href="#MPI-Profiling">MPI Profiling</a><a id="MPI-Profiling-1"></a><a class="docs-heading-anchor-permalink" href="#MPI-Profiling" title="Permalink"></a></h3><p>Use MPI profiling tools to identify bottlenecks:</p><pre><code class="language-bash hljs"># With mpiP
mpiexec -n 8 julia --project=. script.jl

# With Intel MPI
export I_MPI_STATS=20
mpiexec -n 8 julia script.jl</code></pre><h3 id="Tarang.jl-Built-in-Profiling"><a class="docs-heading-anchor" href="#Tarang.jl-Built-in-Profiling">Tarang.jl Built-in Profiling</a><a id="Tarang.jl-Built-in-Profiling-1"></a><a class="docs-heading-anchor-permalink" href="#Tarang.jl-Built-in-Profiling" title="Permalink"></a></h3><p>Enable performance logging:</p><pre><code class="language-julia hljs">using Tarang

# Setup logging with MPI awareness
Tarang.setup_tarang_logging(
    level=&quot;INFO&quot;,
    filename=&quot;performance.log&quot;,
    mpi_aware=true,
    console=true
)</code></pre><h3 id="Timing-Critical-Sections"><a class="docs-heading-anchor" href="#Timing-Critical-Sections">Timing Critical Sections</a><a id="Timing-Critical-Sections-1"></a><a class="docs-heading-anchor-permalink" href="#Timing-Critical-Sections" title="Permalink"></a></h3><p>Add timing to your simulation:</p><pre><code class="language-julia hljs">using Printf

t_start = time()

# ... simulation code ...

t_end = time()
elapsed = t_end - t_start

if MPI.Comm_rank(MPI.COMM_WORLD) == 0
    @printf &quot;Total time: %.2f seconds\n&quot; elapsed
end</code></pre><h2 id="Debugging-MPI-Applications"><a class="docs-heading-anchor" href="#Debugging-MPI-Applications">Debugging MPI Applications</a><a id="Debugging-MPI-Applications-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-MPI-Applications" title="Permalink"></a></h2><h3 id="Running-in-Serial"><a class="docs-heading-anchor" href="#Running-in-Serial">Running in Serial</a><a id="Running-in-Serial-1"></a><a class="docs-heading-anchor-permalink" href="#Running-in-Serial" title="Permalink"></a></h3><p>Test your code without MPI first:</p><pre><code class="language-bash hljs">julia script.jl  # No mpiexec</code></pre><p>Modify your script to use 1 process:</p><pre><code class="language-julia hljs">dist = Distributor(coords, mesh=(1, 1))</code></pre><h3 id="MPI-Debugging-Tools"><a class="docs-heading-anchor" href="#MPI-Debugging-Tools">MPI Debugging Tools</a><a id="MPI-Debugging-Tools-1"></a><a class="docs-heading-anchor-permalink" href="#MPI-Debugging-Tools" title="Permalink"></a></h3><p>Use parallel debuggers:</p><pre><code class="language-bash hljs"># With TotalView
mpiexec -tv -n 4 julia script.jl

# With DDT (ARM Forge)
ddt mpiexec -n 4 julia script.jl

# With gdb (attach to rank 0)
mpiexec -n 4 xterm -e gdb julia script.jl</code></pre><h3 id="Rank-Specific-Output"><a class="docs-heading-anchor" href="#Rank-Specific-Output">Rank-Specific Output</a><a id="Rank-Specific-Output-1"></a><a class="docs-heading-anchor-permalink" href="#Rank-Specific-Output" title="Permalink"></a></h3><p>Debug specific MPI ranks:</p><pre><code class="language-julia hljs">rank = MPI.Comm_rank(MPI.COMM_WORLD)

if rank == 0
    println(&quot;Debug: Rank 0 data = &quot;, data)
end

# Or debug all ranks
println(&quot;Rank $rank: data = $data&quot;)</code></pre><h2 id="Common-Issues-and-Solutions"><a class="docs-heading-anchor" href="#Common-Issues-and-Solutions">Common Issues and Solutions</a><a id="Common-Issues-and-Solutions-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Issues-and-Solutions" title="Permalink"></a></h2><h3 id="Deadlocks"><a class="docs-heading-anchor" href="#Deadlocks">Deadlocks</a><a id="Deadlocks-1"></a><a class="docs-heading-anchor-permalink" href="#Deadlocks" title="Permalink"></a></h3><p><strong>Symptom</strong>: Program hangs without error</p><p><strong>Causes</strong>:</p><ul><li>Mismatched collective operations</li><li>Ranks waiting for different communications</li><li>Incorrect synchronization</li></ul><p><strong>Solution</strong>: Ensure all ranks participate in collective operations:</p><pre><code class="language-julia hljs"># All ranks must call collective operations
MPI.Barrier(MPI.COMM_WORLD)  # All ranks must call this</code></pre><h3 id="Load-Imbalance"><a class="docs-heading-anchor" href="#Load-Imbalance">Load Imbalance</a><a id="Load-Imbalance-1"></a><a class="docs-heading-anchor-permalink" href="#Load-Imbalance" title="Permalink"></a></h3><p><strong>Symptom</strong>: Some ranks finish much faster than others</p><p><strong>Solution</strong>: Check domain decomposition and adjust mesh:</p><pre><code class="language-julia hljs"># Before (imbalanced for tall domain)
mesh=(8, 2)

# After (better for tall domain)
mesh=(4, 4)</code></pre><h3 id="Memory-Issues"><a class="docs-heading-anchor" href="#Memory-Issues">Memory Issues</a><a id="Memory-Issues-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Issues" title="Permalink"></a></h3><p><strong>Symptom</strong>: Out of memory errors on some ranks</p><p><strong>Solution</strong>: Reduce resolution or increase process count:</p><pre><code class="language-julia hljs"># Reduce resolution
x_basis = RealFourier(coords[&quot;x&quot;], size=512, ...)  # was 1024

# Or use more processes to distribute memory
mesh=(8, 8)  # was (4, 4)</code></pre><h3 id="Wrong-Number-of-Processes"><a class="docs-heading-anchor" href="#Wrong-Number-of-Processes">Wrong Number of Processes</a><a id="Wrong-Number-of-Processes-1"></a><a class="docs-heading-anchor-permalink" href="#Wrong-Number-of-Processes" title="Permalink"></a></h3><p><strong>Symptom</strong>: <code>ERROR: Process count mismatch</code></p><p><strong>Solution</strong>: Match <code>mpiexec -n</code> to <code>mesh</code> product:</p><pre><code class="language-julia hljs">mesh=(4, 2)  # requires mpiexec -n 8</code></pre><h2 id="Performance-Tips"><a class="docs-heading-anchor" href="#Performance-Tips">Performance Tips</a><a id="Performance-Tips-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-Tips" title="Permalink"></a></h2><h3 id="Optimal-Process-Count"><a class="docs-heading-anchor" href="#Optimal-Process-Count">Optimal Process Count</a><a id="Optimal-Process-Count-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-Process-Count" title="Permalink"></a></h3><ol><li><strong>Start with square meshes</strong>: <code>mesh=(4,4)</code>, <code>(8,8)</code>, etc.</li><li><strong>Profile with different counts</strong>: Try 4, 8, 16, 32 processes</li><li><strong>Check scaling</strong>: Plot speedup vs. process count</li><li><strong>Consider communication</strong>: More processes = more communication overhead</li></ol><h3 id="Node-Level-Optimization"><a class="docs-heading-anchor" href="#Node-Level-Optimization">Node-Level Optimization</a><a id="Node-Level-Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Node-Level-Optimization" title="Permalink"></a></h3><p>On multi-socket nodes:</p><pre><code class="language-bash hljs"># Bind processes to cores
mpiexec -n 16 --bind-to core julia script.jl

# Use one process per socket
mpiexec -n 2 --map-by socket julia script.jl</code></pre><h3 id="Network-Optimization"><a class="docs-heading-anchor" href="#Network-Optimization">Network Optimization</a><a id="Network-Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Network-Optimization" title="Permalink"></a></h3><p>For InfiniBand or high-speed networks:</p><pre><code class="language-bash hljs"># Enable UCX (if available)
export OMPI_MCA_pml=ucx
export OMPI_MCA_osc=ucx

mpiexec -n 32 julia script.jl</code></pre><h2 id="Benchmarking"><a class="docs-heading-anchor" href="#Benchmarking">Benchmarking</a><a id="Benchmarking-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmarking" title="Permalink"></a></h2><h3 id="Weak-Scaling"><a class="docs-heading-anchor" href="#Weak-Scaling">Weak Scaling</a><a id="Weak-Scaling-1"></a><a class="docs-heading-anchor-permalink" href="#Weak-Scaling" title="Permalink"></a></h3><p>Keep local problem size constant, increase total size:</p><pre><code class="language-julia hljs"># 4 processes: 128×64 per process
mesh=(2, 2); x_size=256; z_size=128

# 16 processes: 128×64 per process
mesh=(4, 4); x_size=512; z_size=256

# 64 processes: 128×64 per process
mesh=(8, 8); x_size=1024; z_size=512</code></pre><p>Ideal weak scaling: time remains constant.</p><h3 id="Strong-Scaling"><a class="docs-heading-anchor" href="#Strong-Scaling">Strong Scaling</a><a id="Strong-Scaling-1"></a><a class="docs-heading-anchor-permalink" href="#Strong-Scaling" title="Permalink"></a></h3><p>Keep total problem size constant, increase processes:</p><pre><code class="language-julia hljs"># All use: x_size=1024, z_size=512
mesh=(2, 2)  # 4 processes
mesh=(4, 4)  # 16 processes
mesh=(8, 8)  # 64 processes</code></pre><p>Ideal strong scaling: time decreases linearly with processes.</p><h2 id="Next-Steps"><a class="docs-heading-anchor" href="#Next-Steps">Next Steps</a><a id="Next-Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Next-Steps" title="Permalink"></a></h2><ul><li><a href="../first_steps/">First Steps</a>: Basic Tarang.jl workflow</li><li><a href="../../tutorials/overview/">Tutorials</a>: Example simulations with MPI</li><li><a href="../../pages/configuration/">Configuration</a>: Advanced MPI configuration options</li><li><a href="../../pages/parallelism/">Parallelism Guide</a>: Deep dive into parallel algorithms</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../first_steps/">« First Steps with Tarang.jl</a><a class="docs-footer-nextpage" href="../../pages/configuration/">Configuration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and <a href="https://julialang.org">Julia</a>. Tarang.jl © 2024 Subhajit Kar.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Sunday 18 January 2026 10:15">Sunday 18 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
