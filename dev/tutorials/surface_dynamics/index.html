<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Surface and Boundary Dynamics · Tarang.jl</title><meta name="title" content="Surface and Boundary Dynamics · Tarang.jl"/><meta property="og:title" content="Surface and Boundary Dynamics · Tarang.jl"/><meta property="twitter:title" content="Surface and Boundary Dynamics · Tarang.jl"/><meta name="description" content="Documentation for Tarang.jl."/><meta property="og:description" content="Documentation for Tarang.jl."/><meta property="twitter:description" content="Documentation for Tarang.jl."/><meta property="og:url" content="https://subhk.github.io/Tarang.jl/tutorials/surface_dynamics/"/><meta property="twitter:url" content="https://subhk.github.io/Tarang.jl/tutorials/surface_dynamics/"/><link rel="canonical" href="https://subhk.github.io/Tarang.jl/tutorials/surface_dynamics/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Tarang.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Tarang.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Installing Tarang</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../getting_started/installation/">Installation</a></li><li><a class="tocitem" href="../../getting_started/first_steps/">First Steps with Tarang.jl</a></li><li><a class="tocitem" href="../../getting_started/running_with_mpi/">Running with MPI</a></li><li><a class="tocitem" href="../../pages/configuration/">Configuration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials &amp; Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox" checked/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Tutorial Notebooks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Tutorials Overview</a></li><li><a class="tocitem" href="../ivp_2d_rbc/">Tutorial: 2D Rayleigh-Bénard Convection</a></li><li><a class="tocitem" href="../ivp_3d_turbulence/">Tutorial: 3D Turbulence Simulation</a></li><li><a class="tocitem" href="../boundary_conditions/">Tutorial: Boundary Conditions</a></li><li><a class="tocitem" href="../analysis_and_output/">Tutorial: Analysis and Output</a></li><li><a class="tocitem" href="../eigenvalue_problems/">Tutorial: Eigenvalue Problems</a></li><li class="is-active"><a class="tocitem" href>Surface and Boundary Dynamics</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#The-Advection-Diffusion-Equation"><span>The Advection-Diffusion Equation</span></a></li><li><a class="tocitem" href="#Velocity-Sources"><span>Velocity Sources</span></a></li><li><a class="tocitem" href="#Diffusion-Types"><span>Diffusion Types</span></a></li><li><a class="tocitem" href="#Complete-SQG-Example"><span>Complete SQG Example</span></a></li><li><a class="tocitem" href="#Multiple-Boundaries-(QG-like)"><span>Multiple Boundaries (QG-like)</span></a></li><li><a class="tocitem" href="#Adding-Source-Terms"><span>Adding Source Terms</span></a></li><li><a class="tocitem" href="#Available-Timesteppers"><span>Available Timesteppers</span></a></li><li><a class="tocitem" href="#Diagnostics"><span>Diagnostics</span></a></li><li><a class="tocitem" href="#Adaptive-Timestepping"><span>Adaptive Timestepping</span></a></li><li><a class="tocitem" href="#MPI-Parallelism"><span>MPI Parallelism</span></a></li><li><a class="tocitem" href="#Comparison-with-Dedicated-QGSystem"><span>Comparison with Dedicated QGSystem</span></a></li><li><a class="tocitem" href="#Summary"><span>Summary</span></a></li><li><a class="tocitem" href="#See-Also"><span>See Also</span></a></li></ul></li><li><a class="tocitem" href="../rotating_shallow_water/">Rotating Shallow Water with Lagrangian Averaging</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Example Scripts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/gallery/">Example Gallery</a></li><li><a class="tocitem" href="../../examples/fluid_dynamics/">Fluid Dynamics Examples</a></li><li><a class="tocitem" href="../../examples/heat_transfer/">Heat Transfer Examples</a></li><li><a class="tocitem" href="../../examples/eigenvalue_analysis/">Eigenvalue Analysis Examples</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Jupyter Notebooks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../notebooks/rayleigh_benard/">Notebook: Rayleigh-Bénard Convection</a></li><li><a class="tocitem" href="../../notebooks/channel_flow/">Notebook: Channel Flow</a></li><li><a class="tocitem" href="../../notebooks/taylor_green/">Notebook: Taylor-Green Vortex</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">User Guide</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Core Concepts</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/coordinates/">Coordinates</a></li><li><a class="tocitem" href="../../pages/bases/">Spectral Bases</a></li><li><a class="tocitem" href="../../pages/domains/">Domains</a></li><li><a class="tocitem" href="../../pages/fields/">Fields</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Problem Setup</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/operators/">Operators</a></li><li><a class="tocitem" href="../../pages/problems/">Problems</a></li><li><a class="tocitem" href="../../pages/solvers/">Solvers</a></li><li><a class="tocitem" href="../../pages/timesteppers/">Time Steppers</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Physics &amp; Modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/stochastic_forcing/">Stochastic Forcing</a></li><li><a class="tocitem" href="../../pages/temporal_filters/">Temporal Filters for Lagrangian Averaging</a></li><li><a class="tocitem" href="../../pages/les_models/">Large Eddy Simulation (LES) Models</a></li><li><a class="tocitem" href="../../pages/gql_approximation/">Generalized Quasi-Linear (GQL) Approximation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Performance &amp; Parallelism</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/gpu_computing/">GPU Computing</a></li><li><a class="tocitem" href="../../pages/parallelism/">Parallelism</a></li><li><a class="tocitem" href="../../pages/optimization/">Performance Optimization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Analysis &amp; Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/analysis/">Analysis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Advanced Topics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/tau_method/">The Tau Method for Boundary Conditions</a></li><li><a class="tocitem" href="../../pages/custom_operators/">Custom Operators</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Core</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/coordinates/">Coordinates API</a></li><li><a class="tocitem" href="../../api/bases/">Bases API</a></li><li><a class="tocitem" href="../../api/domains/">Domains API</a></li><li><a class="tocitem" href="../../api/fields/">Fields API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Operators &amp; Problems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/operators/">Operators API</a></li><li><a class="tocitem" href="../../api/problems/">Problems API</a></li><li><a class="tocitem" href="../../api/solvers/">Solvers API</a></li><li><a class="tocitem" href="../../api/timesteppers/">Timesteppers API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">GPU &amp; Performance</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/gpu/">GPU API Reference</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Extras</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/stochastic_forcing/">Stochastic Forcing API</a></li><li><a class="tocitem" href="../../api/les_models/">LES Models API</a></li><li><a class="tocitem" href="../../api/analysis/">Analysis API</a></li><li><a class="tocitem" href="../../api/io/">I/O API</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Development</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../pages/contributing/">Contributing</a></li><li><a class="tocitem" href="../../pages/architecture/">Architecture</a></li><li><a class="tocitem" href="../../pages/testing/">Testing</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials &amp; Examples</a></li><li><a class="is-disabled">Tutorial Notebooks</a></li><li class="is-active"><a href>Surface and Boundary Dynamics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Surface and Boundary Dynamics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/subhk/Tarang.jl/blob/main/docs/src/tutorials/surface_dynamics.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Surface-and-Boundary-Dynamics"><a class="docs-heading-anchor" href="#Surface-and-Boundary-Dynamics">Surface and Boundary Dynamics</a><a id="Surface-and-Boundary-Dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-and-Boundary-Dynamics" title="Permalink"></a></h1><p>This tutorial covers solving advection-diffusion equations on domain boundaries, including Surface Quasi-Geostrophic (SQG) dynamics and general boundary-coupled systems.</p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>Many physical systems involve dynamics confined to surfaces or boundaries:</p><ul><li><strong>Surface Quasi-Geostrophic (SQG)</strong>: Ocean/atmosphere surface temperature dynamics</li><li><strong>Quasi-Geostrophic (QG)</strong>: Coupled surface buoyancy with interior PV</li><li><strong>Passive tracers</strong>: Concentration advected by prescribed flow</li><li><strong>Reactive surfaces</strong>: Chemical species on catalytic surfaces</li></ul><p>Tarang provides a flexible <code>BoundaryAdvectionDiffusion</code> framework for all these cases.</p><h2 id="The-Advection-Diffusion-Equation"><a class="docs-heading-anchor" href="#The-Advection-Diffusion-Equation">The Advection-Diffusion Equation</a><a id="The-Advection-Diffusion-Equation-1"></a><a class="docs-heading-anchor-permalink" href="#The-Advection-Diffusion-Equation" title="Permalink"></a></h2><p>The general equation solved on each boundary is:</p><pre><code class="nohighlight hljs">∂c/∂t + u·∇c = D(c) + S</code></pre><p>where:</p><ul><li><code>c</code> is the scalar field (buoyancy, concentration, temperature)</li><li><code>u</code> is the advection velocity</li><li><code>D(c)</code> is the diffusion operator</li><li><code>S</code> is an optional source term</li></ul><h2 id="Velocity-Sources"><a class="docs-heading-anchor" href="#Velocity-Sources">Velocity Sources</a><a id="Velocity-Sources-1"></a><a class="docs-heading-anchor-permalink" href="#Velocity-Sources" title="Permalink"></a></h2><p>The key difference between problems is how the velocity <code>u</code> is obtained:</p><h3 id="1.-Self-Derived-Velocity-(SQG-like)"><a class="docs-heading-anchor" href="#1.-Self-Derived-Velocity-(SQG-like)">1. Self-Derived Velocity (SQG-like)</a><a id="1.-Self-Derived-Velocity-(SQG-like)-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Self-Derived-Velocity-(SQG-like)" title="Permalink"></a></h3><p>Velocity computed from the boundary field itself through an inversion:</p><pre><code class="nohighlight hljs">ψ = (-Δ)^α c      (fractional Laplacian inversion)
u = ∇⊥ψ           (perpendicular gradient for incompressibility)</code></pre><p>For SQG, <code>α = -1/2</code>, giving <code>ψ = (-Δ)^(-1/2) θ</code>.</p><pre><code class="language-julia hljs">using Tarang

# SQG setup: velocity from buoyancy inversion
bad = boundary_advection_diffusion_setup(
    Lx=2π, Ly=2π,
    Nx=256, Ny=256,
    boundaries=[BoundarySpec(&quot;theta&quot;, :z, 0.0)],
    velocity_source=SelfDerivedVelocity(
        inversion_exponent=-0.5,  # SQG: ψ = (-Δ)^(-1/2) θ
        use_perp_grad=true        # u = ∇⊥ψ (incompressible)
    ),
    diffusion=DiffusionSpec(
        type=:fractional,
        coefficient=1e-4,
        exponent=0.5              # Physical SQG dissipation
    )
)</code></pre><h3 id="2.-Interior-Derived-Velocity-(QG-like)"><a class="docs-heading-anchor" href="#2.-Interior-Derived-Velocity-(QG-like)">2. Interior-Derived Velocity (QG-like)</a><a id="2.-Interior-Derived-Velocity-(QG-like)-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Interior-Derived-Velocity-(QG-like)" title="Permalink"></a></h3><p>Velocity extracted from a 3D interior field at the boundary:</p><pre><code class="language-julia hljs"># QG setup: velocity from interior streamfunction
bad = boundary_advection_diffusion_setup(
    Lx=2π, Ly=2π,
    Nx=128, Ny=128,
    boundaries=[
        BoundarySpec(&quot;bottom&quot;, :z, 0.0),
        BoundarySpec(&quot;top&quot;, :z, 1.0)
    ],
    velocity_source=InteriorDerivedVelocity(:perp_grad),  # u = ∇⊥ψ|_{surface}
    diffusion=DiffusionSpec(type=:fractional, coefficient=1e-4, exponent=0.5),
    interior_coupling=(
        Nz=32,
        H=1.0,
        equation=&quot;Δ(ψ) + S*∂z(∂z(ψ)) = q&quot;,  # QG elliptic operator
        params=Dict(&quot;S&quot; =&gt; 0.01, &quot;q&quot; =&gt; 0.0)
    )
)</code></pre><h3 id="3.-Prescribed-Velocity-(Passive-Tracer)"><a class="docs-heading-anchor" href="#3.-Prescribed-Velocity-(Passive-Tracer)">3. Prescribed Velocity (Passive Tracer)</a><a id="3.-Prescribed-Velocity-(Passive-Tracer)-1"></a><a class="docs-heading-anchor-permalink" href="#3.-Prescribed-Velocity-(Passive-Tracer)" title="Permalink"></a></h3><p>Velocity set externally by the user each timestep:</p><pre><code class="language-julia hljs"># Passive tracer in prescribed flow
bad = boundary_advection_diffusion_setup(
    Lx=2π, Ly=2π,
    Nx=128, Ny=128,
    boundaries=[BoundarySpec(&quot;concentration&quot;, :z, 0.0)],
    velocity_source=PrescribedVelocity(),
    diffusion=DiffusionSpec(type=:laplacian, coefficient=0.01)
)

# In time loop, set velocity before stepping
function set_velocity!(bad, t)
    # Example: rotating flow
    x, y = get_coordinates(bad)
    bad.velocities[&quot;concentration&quot;].components[1].data_g .= -sin.(y)
    bad.velocities[&quot;concentration&quot;].components[2].data_g .= sin.(x)
end</code></pre><h2 id="Diffusion-Types"><a class="docs-heading-anchor" href="#Diffusion-Types">Diffusion Types</a><a id="Diffusion-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Diffusion-Types" title="Permalink"></a></h2><h3 id="Standard-Laplacian"><a class="docs-heading-anchor" href="#Standard-Laplacian">Standard Laplacian</a><a id="Standard-Laplacian-1"></a><a class="docs-heading-anchor-permalink" href="#Standard-Laplacian" title="Permalink"></a></h3><pre><code class="language-julia hljs">DiffusionSpec(type=:laplacian, coefficient=0.01)
# Gives: κΔc</code></pre><h3 id="Fractional-Laplacian"><a class="docs-heading-anchor" href="#Fractional-Laplacian">Fractional Laplacian</a><a id="Fractional-Laplacian-1"></a><a class="docs-heading-anchor-permalink" href="#Fractional-Laplacian" title="Permalink"></a></h3><pre><code class="language-julia hljs">DiffusionSpec(type=:fractional, coefficient=1e-4, exponent=0.5)
# Gives: -κ(-Δ)^α c</code></pre><p>Common exponents:</p><ul><li><code>α = 0.5</code>: Physical SQG dissipation</li><li><code>α = 1.0</code>: Standard Laplacian (equivalent to <code>:laplacian</code>)</li><li><code>α = 2.0</code>: Biharmonic (hyperviscosity)</li></ul><h3 id="Hyperdiffusion"><a class="docs-heading-anchor" href="#Hyperdiffusion">Hyperdiffusion</a><a id="Hyperdiffusion-1"></a><a class="docs-heading-anchor-permalink" href="#Hyperdiffusion" title="Permalink"></a></h3><pre><code class="language-julia hljs">DiffusionSpec(type=:hyperdiffusion, coefficient=1e-8, exponent=2.0)
# Gives: -κ(-Δ)^n c (typically n=2 for biharmonic)</code></pre><h3 id="No-Diffusion"><a class="docs-heading-anchor" href="#No-Diffusion">No Diffusion</a><a id="No-Diffusion-1"></a><a class="docs-heading-anchor-permalink" href="#No-Diffusion" title="Permalink"></a></h3><pre><code class="language-julia hljs">DiffusionSpec(type=:none)
# Inviscid dynamics</code></pre><h2 id="Complete-SQG-Example"><a class="docs-heading-anchor" href="#Complete-SQG-Example">Complete SQG Example</a><a id="Complete-SQG-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Complete-SQG-Example" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Tarang

# Domain and resolution
Lx, Ly = 2π, 2π
Nx, Ny = 256, 256

# Create SQG system
sqg = boundary_advection_diffusion_setup(
    Lx=Lx, Ly=Ly,
    Nx=Nx, Ny=Ny,
    boundaries=[BoundarySpec(&quot;theta&quot;, :z, 0.0)],
    velocity_source=SelfDerivedVelocity(inversion_exponent=-0.5),
    diffusion=DiffusionSpec(type=:fractional, coefficient=1e-4, exponent=0.5)
)

# Initial condition: random perturbation
θ = sqg.fields[&quot;theta&quot;]
ensure_layout!(θ, :g)

# Create elliptical vortex
x = range(0, Lx, length=Nx)
y = range(0, Ly, length=Ny)
X = [xi for xi in x, _ in y]
Y = [yj for _ in x, yj in y]

θ.data_g .= exp.(-((X .- π).^2 ./ 0.5 .+ (Y .- π).^2 ./ 0.3))

# Time stepping
dt = 0.001
nsteps = 10000
output_interval = 100

for step in 1:nsteps
    bad_step!(sqg, dt; timestepper=:RK4)

    if step % output_interval == 0
        energy = bad_energy(sqg)
        max_vel = bad_max_velocity(sqg)
        println(&quot;Step $step: E = $energy, max|u| = $max_vel&quot;)
    end
end</code></pre><h2 id="Multiple-Boundaries-(QG-like)"><a class="docs-heading-anchor" href="#Multiple-Boundaries-(QG-like)">Multiple Boundaries (QG-like)</a><a id="Multiple-Boundaries-(QG-like)-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-Boundaries-(QG-like)" title="Permalink"></a></h2><p>For problems with dynamics at multiple surfaces:</p><pre><code class="language-julia hljs"># Two-surface QG system
qg = boundary_advection_diffusion_setup(
    Lx=2π, Ly=2π,
    Nx=128, Ny=128,
    boundaries=[
        BoundarySpec(&quot;theta_bot&quot;, :z, 0.0; field_name=&quot;θ_bottom&quot;),
        BoundarySpec(&quot;theta_top&quot;, :z, 1.0; field_name=&quot;θ_top&quot;)
    ],
    velocity_source=InteriorDerivedVelocity(:perp_grad),
    diffusion=DiffusionSpec(type=:fractional, coefficient=1e-4, exponent=0.5),
    interior_coupling=(
        Nz=32,
        H=1.0,
        equation=&quot;Δ(ψ) + S*∂z(∂z(ψ)) = 0&quot;,
        params=Dict(&quot;S&quot; =&gt; (1.0/10.0)^2)  # (f₀/N)²
    )
)

# Set different initial conditions at each surface
qg.fields[&quot;theta_bot&quot;].data_g .= initial_bottom
qg.fields[&quot;theta_top&quot;].data_g .= initial_top

# Both surfaces evolve together
for step in 1:nsteps
    bad_step!(qg, dt)
end</code></pre><h2 id="Adding-Source-Terms"><a class="docs-heading-anchor" href="#Adding-Source-Terms">Adding Source Terms</a><a id="Adding-Source-Terms-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-Source-Terms" title="Permalink"></a></h2><p>Custom source terms can be added:</p><pre><code class="language-julia hljs"># Gaussian forcing centered at (π, π)
function my_forcing(bad, boundary_name)
    θ = bad.fields[boundary_name]
    Nx, Ny = size(θ.data_g)

    x = range(0, bad.params[&quot;Lx&quot;], length=Nx)
    y = range(0, bad.params[&quot;Ly&quot;], length=Ny)

    forcing = zeros(Nx, Ny)
    for j in 1:Ny, i in 1:Nx
        r2 = (x[i] - π)^2 + (y[j] - π)^2
        forcing[i, j] = 0.1 * exp(-r2 / 0.5)
    end

    return forcing
end

bad_add_source!(sqg, &quot;theta&quot;, my_forcing)</code></pre><h2 id="Available-Timesteppers"><a class="docs-heading-anchor" href="#Available-Timesteppers">Available Timesteppers</a><a id="Available-Timesteppers-1"></a><a class="docs-heading-anchor-permalink" href="#Available-Timesteppers" title="Permalink"></a></h2><table><tr><th style="text-align: right">Method</th><th style="text-align: right">Order</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>:Euler</code></td><td style="text-align: right">1</td><td style="text-align: right">Forward Euler</td></tr><tr><td style="text-align: right"><code>:RK2</code></td><td style="text-align: right">2</td><td style="text-align: right">Midpoint method</td></tr><tr><td style="text-align: right"><code>:RK4</code></td><td style="text-align: right">4</td><td style="text-align: right">Classical Runge-Kutta</td></tr><tr><td style="text-align: right"><code>:SSPRK3</code></td><td style="text-align: right">3</td><td style="text-align: right">Strong Stability Preserving RK3</td></tr></table><pre><code class="language-julia hljs">bad_step!(sqg, dt; timestepper=:SSPRK3)</code></pre><h2 id="Diagnostics"><a class="docs-heading-anchor" href="#Diagnostics">Diagnostics</a><a id="Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics" title="Permalink"></a></h2><h3 id="Energy"><a class="docs-heading-anchor" href="#Energy">Energy</a><a id="Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Energy" title="Permalink"></a></h3><pre><code class="language-julia hljs">E = bad_energy(sqg)  # Total L² energy across all boundaries</code></pre><h3 id="Enstrophy"><a class="docs-heading-anchor" href="#Enstrophy">Enstrophy</a><a id="Enstrophy-1"></a><a class="docs-heading-anchor-permalink" href="#Enstrophy" title="Permalink"></a></h3><pre><code class="language-julia hljs">Z = bad_enstrophy(sqg, &quot;theta&quot;)  # Squared gradient of specific field</code></pre><h3 id="Maximum-Velocity"><a class="docs-heading-anchor" href="#Maximum-Velocity">Maximum Velocity</a><a id="Maximum-Velocity-1"></a><a class="docs-heading-anchor-permalink" href="#Maximum-Velocity" title="Permalink"></a></h3><pre><code class="language-julia hljs">umax = bad_max_velocity(sqg)</code></pre><h3 id="CFL-Timestep"><a class="docs-heading-anchor" href="#CFL-Timestep">CFL Timestep</a><a id="CFL-Timestep-1"></a><a class="docs-heading-anchor-permalink" href="#CFL-Timestep" title="Permalink"></a></h3><pre><code class="language-julia hljs">dt_cfl = bad_cfl_dt(sqg; safety=0.5)</code></pre><h2 id="Adaptive-Timestepping"><a class="docs-heading-anchor" href="#Adaptive-Timestepping">Adaptive Timestepping</a><a id="Adaptive-Timestepping-1"></a><a class="docs-heading-anchor-permalink" href="#Adaptive-Timestepping" title="Permalink"></a></h2><pre><code class="language-julia hljs">for step in 1:nsteps
    # Compute CFL-limited timestep
    dt = bad_cfl_dt(sqg; safety=0.4)
    dt = min(dt, dt_max)  # Cap maximum timestep

    bad_step!(sqg, dt)

    sqg.time  # Current simulation time
end</code></pre><h2 id="MPI-Parallelism"><a class="docs-heading-anchor" href="#MPI-Parallelism">MPI Parallelism</a><a id="MPI-Parallelism-1"></a><a class="docs-heading-anchor-permalink" href="#MPI-Parallelism" title="Permalink"></a></h2><p>The framework supports MPI domain decomposition:</p><pre><code class="language-julia hljs">sqg = boundary_advection_diffusion_setup(
    Lx=2π, Ly=2π,
    Nx=512, Ny=512,
    boundaries=[BoundarySpec(&quot;theta&quot;, :z, 0.0)],
    velocity_source=SelfDerivedVelocity(inversion_exponent=-0.5),
    diffusion=DiffusionSpec(type=:fractional, coefficient=1e-4, exponent=0.5),
    mesh=(4, 4)  # 4×4 = 16 MPI processes
)</code></pre><p>Run with:</p><pre><code class="language-bash hljs">mpiexec -n 16 julia my_sqg_simulation.jl</code></pre><h2 id="Comparison-with-Dedicated-QGSystem"><a class="docs-heading-anchor" href="#Comparison-with-Dedicated-QGSystem">Comparison with Dedicated QGSystem</a><a id="Comparison-with-Dedicated-QGSystem-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison-with-Dedicated-QGSystem" title="Permalink"></a></h2><p>For full QG with interior PV dynamics, you can also use the specialized <code>QGSystem</code>:</p><pre><code class="language-julia hljs"># Using dedicated QGSystem (more features for QG-specific problems)
qg = qg_system_setup(
    Lx=2π, Ly=2π, H=1.0,
    Nx=128, Ny=128, Nz=32,
    f0=1.0, N=10.0,
    κ=1e-4, α=0.5
)

qg_step!(qg, dt; timestepper=:RK4)
E = qg_energy(qg)</code></pre><p>The <code>BoundaryAdvectionDiffusion</code> framework is more general and flexible, while <code>QGSystem</code> provides QG-specific functionality.</p><h2 id="Summary"><a class="docs-heading-anchor" href="#Summary">Summary</a><a id="Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Summary" title="Permalink"></a></h2><table><tr><th style="text-align: right">Use Case</th><th style="text-align: right">Velocity Source</th><th style="text-align: right">Example</th></tr><tr><td style="text-align: right">SQG</td><td style="text-align: right"><code>SelfDerivedVelocity</code></td><td style="text-align: right">Surface buoyancy dynamics</td></tr><tr><td style="text-align: right">QG</td><td style="text-align: right"><code>InteriorDerivedVelocity</code></td><td style="text-align: right">Coupled surface-interior</td></tr><tr><td style="text-align: right">Passive tracer</td><td style="text-align: right"><code>PrescribedVelocity</code></td><td style="text-align: right">Tracer in known flow</td></tr></table><h2 id="See-Also"><a class="docs-heading-anchor" href="#See-Also">See Also</a><a id="See-Also-1"></a><a class="docs-heading-anchor-permalink" href="#See-Also" title="Permalink"></a></h2><ul><li><a href="../../pages/operators/">Operators</a>: Fractional Laplacian details</li><li><a href="../../pages/problems/">Problems</a>: IVP and LBVP setup</li><li><a href="../../pages/solvers/">Solvers</a>: Timestepping and BVP solvers</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../eigenvalue_problems/">« Tutorial: Eigenvalue Problems</a><a class="docs-footer-nextpage" href="../rotating_shallow_water/">Rotating Shallow Water with Lagrangian Averaging »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and <a href="https://julialang.org">Julia</a>. Tarang.jl © 2024 Subhajit Kar.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Sunday 18 January 2026 08:59">Sunday 18 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
